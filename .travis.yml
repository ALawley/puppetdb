language: clojure
lein: 2.7.1
dist: trusty

# Always explicitly set sudo.  Otherwise travis' defaults may vary
# based on when the repository testing was enabled.
sudo: required

matrix:
  include:
    # terminus unit tests (spec tests)
    - env: >
        NAME=rspec-puppet-master
        PDB_TEST_LANG=ruby
        PUPPET_VERSION=master

    # pdb unit tests
    - env: >
        NAME=unit-openjdk8
        PDB_TEST_LANG=clojure
        PDB_TEST_SELECTOR=:unit
      jdk: openjdk8

    - env: >
        NAME=unit-oracle8
        PDB_TEST_LANG=clojure
        PDB_TEST_SELECTOR=:unit
      jdk: oraclejdk8


    # pdb + terminus + puppetserver + puppet integration tests
    - env: >
        NAME=integration-master-puppet-openjdk8
        PDB_TEST_LANG=clojure
        PDB_TEST_SELECTOR=:integration
        PUPPET_VERSION=master
        PUPPETSERVER_VERSION=master
      jdk: openjdk8

    - env: >
        NAME=integration-master-puppet-oraclejdk8
        PDB_TEST_LANG=clojure
        PDB_TEST_SELECTOR=:integration
        PUPPET_VERSION=master
        PUPPETSERVER_VERSION=master
      jdk: oraclejdk8

before_install: ext/travisci/install_puppetserver.sh
script: ext/travisci/test.sh

notifications:
  email: false
  hipchat:
    rooms:
      secure: "VGChGfUfEHrESgJ98tGcmmN3Lf63R9tnIi5LiOfmCuV8KNtAntG6HoBuod2mJREM3Fw8/KgQ888KZi1D8r3SDvmO0YUjC5K2OX7vQenjhw7TiHqNvGsTFSh8hdAwc/+punzZ/5j9vbiDqkI4MDtkSdlsPORBD7Rjxnh53X9VYrE="
    template:
      - '%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{message}'

addons:
  postgresql: "9.6"

services: postgresql
